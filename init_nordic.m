%% Define susceptances as in thesis
b_11_12 = 1/0.7; % NO4_SE1
b_11_13 = 1/0.3; % NO4_SE2
b_11_14 = 1/1.0; % NO4_NO3
b_11_15 = 1/0.1; % NO4_FI 
b_12_13 = 1/3.3; % SE1_SE2
b_12_15 = 1/1.5; % SE1_FI
b_13_14 = 1/1.0; % SE2_NO3
b_13_18 = 1/7.3; % SE2_SE3
b_14_17 = 1/0.5; % NO3_NO1
b_15_18 = 1/1.2; % FI_SE3
b_16_17 = 1/3.9; % NO5_NO1
b_16_19 = 1/0.6; % NO5_NO2
b_17_18 = 1/2.145; % NO1_SE3 
b_17_19 = 1/3.5; % NO1_NO2
b_18_20 = 1/5.3; % SE3_SE4
b_20_21 = 1/1.7; % SE4_DK2

b_d1 = 1/0.7;
b_d2 = 1/0.8;
b_d3 = 1/0.7;
b_d4 = 1/0.9;
b_d5 = 1/0.64;
b_d6 = 1/0.6;
b_d7 = 1/0.6;
b_d8 = 1/0.8;
b_d9 = 1/0.7;
b_d10 = 1/0.74;

%% Create matrices
Y_11 = diag([b_d1, b_d2, b_d3, b_d4, b_d5, b_d6, b_d7, b_d8, b_d9, b_d10]);
Y_12 = [-Y_11, zeros(size(Y_11,1),1)];
Y_21 = Y_12';

% Calculate diagonal elements of Y_22
b_11 = b_d1 + b_11_12 + b_11_13 + b_11_14 + b_11_15;
b_12 = b_d2 + b_11_12 + b_12_13 + b_12_15;
b_13 = b_d3 + b_11_13 + b_12_13 + b_13_14 + b_13_18;
b_14 = b_d4 + b_11_14 + b_13_14 + b_14_17;
b_15 = b_d5 + b_11_15 + b_12_15 + b_15_18;
b_16 = b_d6 + b_16_17 + b_16_19;
b_17 = b_d7 + b_14_17 + b_16_17 + b_17_18 + b_17_19;
b_18 = b_d8 + b_13_18 + b_15_18 + b_17_18 + b_18_20;
b_19 = b_d9 + b_16_19 + b_17_19;
b_20 = b_d10 + b_18_20 + b_20_21;
b_21 = b_20_21;

Y_22 =[...
    b_11 -b_11_12 -b_11_13 -b_11_14 -b_11_15 0 0 0 0 0 0;
    -b_11_12 b_12 -b_12_13 0 -b_12_15 0 0 0 0 0 0;
    -b_11_13 -b_12_13 b_13 -b_13_14 0 0 0 -b_13_18 0 0 0;
    -b_11_14 0 -b_13_14 b_14 0 0 -b_14_17 0 0 0 0;
    -b_11_15 -b_12_15 0 0 b_15 0 0 -b_15_18 0 0 0;
    0 0 0 0 0 b_16 -b_16_17 0 0 -b_16_19 0;
    0 0 0 -b_14_17 0 -b_16_17 b_17 -b_17_18 -b_17_19 0 0;
    0 0 -b_13_18 0 -b_15_18 0 -b_17_18 b_18 0 -b_18_20 0;
    0 0 0 0 0 -b_16_19 -b_17_19 0 b_19 0 0;
    0 0 0 0 0 0 0 -b_18_20 0 b_20 -b_20_21;
    0 0 0 0 0 0 0 0 0 -b_20_21 b_21];
X = Y_22^-1;
DC = [Y_11-Y_12*X*Y_21 Y_12*X];

%% Initialize governors
Kp = 0.001;
Ti = 100000;
Tw = 1.5;
Td = 0;
Tf = 0;
R1 = 0.12; % NO4
R2 = 0.12; % SE1
R3 = 0.12; % SE2
R4 = 0.12; % NO3
R5 = 0.025; % FI
R6 = 0.12; % NO5
R7 = 0.12; % NO1
R8 = 0.05; % SE3
R9 = 0.12; % NO2 
R10 = 0.05; % SE4

Ty = 0;
backlash = 0;
Ysp = 0;

%% Initialize machines
H = [3.592 4.602 3.3 3.558 4.925 3.5 3.494 5.403 3.370 7];
Kd1 = 0;

M1 = 5000; % NO4
M2 = 6000; % SE1
M3 = 8000; % SE2
M4 = 4400; % NO3
M5 = 14502; % FI
M6 = 8000; % NO5
M7 = 2650; % NO1
M8 = 15300; % SE3
M9 = 11000; % NO2 
M10 = 7800; % SE4

%% Initialize loads
D = 1/50;
Pl1 = 0.1;
Pl2 = 0;
Pl3 = 0;
Pl4 = 0;
Pl5 = 0;
Pl6 = 0;
Pl7 = 0;
Pl8 = 0;
Pl9 = 0;
Pl10 = 0;
Pl11 = 0;
S_base = 1000;
f0 = 50;